include(AddModule)
include(FetchDependencies)

fetch_openssl()
fetch_libxml2()
fetch_spdlog()
fetch_nlohmann_json()
fetch_yaml_cpp()

add_module(
    MODULE_NAME common 
    HEADERS
        File.h
        Logger.h
        LoggerConfig.h
        base_types/Map.h 
        base_types/Dictionary.h 
        base_types/Uuid.h
        buffer/BufferView.h
        buffer/ReadableBufferView.h
        buffer/WriteableBufferView.h
        concurrency/ThreadCollection.h 
        concurrency/TimedLock.h 
        plugins/PluginHandle.h 
        plugins/PluginLoader.h
        random/IdGenerator.h
        serialization/BaseField.h
        serialization/DictField.h
        serialization/ScalarField.h
        serialization/Serializeable.h
        serialization/SerializeableWithFields.h
        streams/Stream.h
        streams/StreamIO.h
        streams/StreamSource.h
        streams/StreamSink.h
        streams/StreamState.h
        streams/impls/FifoStreamSink.h 
        streams/impls/FifoStreamSource.h
        streams/impls/FileStreamSink.h 
        streams/impls/FileStreamSource.h
        streams/impls/InMemoryStreamSink.h 
        streams/impls/InMemoryStreamSource.h
        utils/StringUtils.h
        utils/FileUtils.h
        utils/XmlUtils.h
        utils/HashUtils.h
        utils/SystemUtils.h 
        utils/JsonUtils.h
        utils/ErrorUtils.h
        utils/TimeUtils.h
        utils/UuidUtils.h
        utils/YamlUtils.h
        xml/XmlAttribute.h 
        xml/XmlDocument.h 
        xml/XmlElement.h 
        xml/XmlProlog.h 
        xml/XmlParser.h
    SOURCES  
        File.cc
        Logger.cc
        LoggerConfig.cc
        base_types/Map.cc
        base_types/Dictionary.cc
        base_types/Uuid.cc
        buffer/ReadableBufferView.cc
        buffer/WriteableBufferView.cc
        concurrency/ThreadCollection.cc
        concurrency/TimedLock.cc
        json/JsonDocument.cc
        plugins/PluginHandle.cc
        plugins/PluginLoader.cc
        random/IdGenerator.cc
        serialization/BaseField.cc
        serialization/DictField.cc
        serialization/ScalarField.cc
        serialization/Serializeable.h
        serialization/SerializeableWithFields.cc
        streams/Stream.cc
        streams/StreamIO.cc
        streams/StreamState.cc
        streams/impls/FifoStreamSink.cc 
        streams/impls/FifoStreamSource.cc
        streams/impls/FileStreamSink.cc 
        streams/impls/FileStreamSource.cc
        streams/impls/InMemoryStreamSink.cc 
        streams/impls/InMemoryStreamSource.cc 
        utils/ErrorUtils.cc
        utils/FileUtils.cc
        utils/HashUtils.cc
        utils/JsonUtils.cc
        utils/SystemUtils.cc
        utils/StringUtils.cc
        utils/XmlUtils.cc
        utils/TimeUtils.cc
        utils/UuidUtils.cc
        utils/YamlUtils.cc
        xml/XmlAttribute.cc  
        xml/XmlDocument.cc
        xml/XmlElement.cc 
        xml/XmlProlog.cc 
        xml/XmlParser.cc
    INTERNAL_INCLUDE_DIRS 
        base_types
        buffer
        concurrency
        json
        plugins
        random
        serialization
        streams
        streams/impls
        utils
        xml
    PRIVATE_DEPENDENCIES
        yaml-cpp::yaml-cpp
        nlohmann_json::nlohmann_json
        spdlog::spdlog
        OpenSSL::SSL 
        OpenSSL::Crypto
        LibXml2::LibXml2
        ${CMAKE_DL_LIBS}
    WITH_FILESYSTEM
)

target_include_directories(${PROJECT_NAME}_common PUBLIC "$<BUILD_INTERFACE:${PROJECT_BINARY_DIR}>")